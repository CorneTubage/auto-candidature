<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Auto Candidature - Noé Arhan</title>
    <!-- Favicon SVG -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Lien vers ton CSS externe -->
    <link rel="stylesheet" href="style.css" />
  </head>
  <body
    class="bg-slate-100 text-slate-800 font-sans h-screen flex overflow-hidden"
  >
    <!-- Sidebar -->
    <aside class="w-64 bg-slate-900 text-white flex flex-col shadow-xl z-20">
      <div class="p-6 border-b border-slate-700">
        <h1 class="text-xl font-bold flex items-center gap-2">
          <i class="fa-solid fa-paper-plane text-indigo-400"></i> AutoApply
        </h1>
        <p class="text-xs text-slate-400 mt-1">Gestionnaire de candidatures</p>
      </div>

      <nav class="flex-1 p-4 space-y-2">
        <button
          onclick="switchTab('dashboard')"
          id="nav-dashboard"
          class="w-full text-left p-3 rounded-lg transition-colors bg-indigo-600 text-white hover:bg-indigo-700 flex items-center gap-3"
        >
          <i class="fa-solid fa-list"></i> Liste Entreprises
        </button>
        <button
          onclick="switchTab('settings')"
          id="nav-settings"
          class="w-full text-left p-3 rounded-lg transition-colors text-slate-300 hover:bg-slate-800 flex items-center gap-3"
        >
          <i class="fa-solid fa-gear"></i> Configuration
        </button>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-full relative">
      <header
        class="h-16 bg-white shadow-sm flex items-center justify-between px-8 z-10"
      >
        <h2 id="page-title" class="text-lg font-semibold text-slate-700">
          Tableau de bord
        </h2>
        <div
          id="connection-status"
          class="flex items-center gap-2 text-sm text-emerald-600"
        >
          <span class="w-2 h-2 rounded-full bg-emerald-500"></span> Système prêt
        </div>
      </header>

      <div class="flex-1 overflow-auto p-8 relative">
        <!-- VIEW: DASHBOARD -->
        <div id="view-dashboard" class="space-y-6">
          <!-- Actions Bar -->
          <div
            class="flex justify-between items-center bg-white p-4 rounded-xl shadow-sm border border-slate-200"
          >
            <div class="flex gap-3 items-center">
              <button
                onclick="openAddModal()"
                class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition shadow-sm flex items-center gap-2"
              >
                <i class="fa-solid fa-plus"></i> Ajouter
              </button>

              <!-- CSV Import -->
              <div class="relative">
                <input
                  type="file"
                  id="csvInput"
                  accept=".csv"
                  class="hidden"
                  onchange="importCSV(this)"
                />
                <button
                  onclick="document.getElementById('csvInput').click()"
                  class="bg-indigo-100 hover:bg-indigo-200 text-indigo-700 border border-indigo-200 px-4 py-2 rounded-lg text-sm font-medium transition flex items-center gap-2"
                >
                  <i class="fa-solid fa-file-csv"></i> Importer
                </button>
              </div>

              <!-- Separator -->
              <div class="h-6 w-px bg-slate-300 mx-1"></div>

              <!-- Sort Dropdown -->
              <div class="relative">
                <select
                  id="sort-select"
                  onchange="handleSort()"
                  class="bg-white border border-slate-300 text-slate-600 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2 pl-3 pr-8 cursor-pointer"
                >
                  <option value="newest">Ajouté récemment</option>
                  <option value="oldest">Ajouté anciennement</option>
                  <option value="name_asc">Nom (A-Z)</option>
                  <option value="name_desc">Nom (Z-A)</option>
                  <option value="status_todo">À faire en premier</option>
                  <option value="status_done">Déjà envoyé</option>
                </select>
              </div>

              <button
                onclick="fetchCompanies()"
                class="bg-white border border-slate-300 hover:bg-slate-50 text-slate-600 px-3 py-2 rounded-lg text-sm font-medium transition flex items-center justify-center"
              >
                <i class="fa-solid fa-rotate"></i>
              </button>
            </div>
            <div class="text-sm text-slate-500">
              <span id="stats-total">0</span> entreprises •
              <span id="stats-sent" class="text-emerald-600 font-bold">0</span>
              envoyées
            </div>
          </div>

          <!-- Table -->
          <div
            class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden"
          >
            <table class="w-full text-left border-collapse">
              <thead
                class="bg-slate-50 text-slate-500 text-xs uppercase font-semibold"
              >
                <tr>
                  <th class="p-4 border-b border-slate-200">Entreprise</th>
                  <th class="p-4 border-b border-slate-200">Email Contact</th>
                  <th class="p-4 border-b border-slate-200">
                    Fichiers détectés
                  </th>
                  <th class="p-4 border-b border-slate-200">Statut</th>
                  <th class="p-4 border-b border-slate-200 text-right">
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody
                id="companies-list"
                class="text-sm text-slate-700 divide-y divide-slate-100"
              >
                <!-- Populated by JS -->
              </tbody>
            </table>
            <div
              id="empty-state"
              class="hidden p-12 text-center text-slate-400"
            >
              <i class="fa-solid fa-folder-open text-4xl mb-3 opacity-20"></i>
              <p>Aucune entreprise ajoutée.</p>
            </div>
          </div>
        </div>

        <!-- VIEW: SETTINGS -->
        <div id="view-settings" class="hidden max-w-4xl mx-auto space-y-6">
          <div
            class="bg-white p-6 rounded-xl shadow-sm border border-slate-200"
          >
            <h3
              class="text-lg font-semibold mb-4 text-indigo-600 border-b pb-2"
            >
              Identité & Fichiers
            </h3>
            <div class="grid grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-xs font-bold text-slate-500 mb-1"
                  >Prénom</label
                >
                <input
                  type="text"
                  id="conf-fname"
                  class="w-full bg-slate-50 border border-slate-300 rounded p-2 outline-none"
                />
              </div>
              <div>
                <label class="block text-xs font-bold text-slate-500 mb-1"
                  >Nom</label
                >
                <input
                  type="text"
                  id="conf-lname"
                  class="w-full bg-slate-50 border border-slate-300 rounded p-2 outline-none"
                />
              </div>
            </div>
            <div>
              <label class="block text-xs font-bold text-slate-500 mb-1"
                >Chemin du dossier des PDFs (Absolu)</label
              >
              <input
                type="text"
                id="conf-path"
                class="w-full bg-slate-50 border border-slate-300 rounded p-2 outline-none font-mono text-xs"
              />
            </div>
          </div>

          <div
            class="bg-white p-6 rounded-xl shadow-sm border border-slate-200"
          >
            <h3
              class="text-lg font-semibold mb-4 text-indigo-600 border-b pb-2"
            >
              Configuration SMTP
            </h3>
            <div class="grid grid-cols-2 gap-4 mb-4">
              <div>
                <label class="block text-xs font-bold text-slate-500 mb-1"
                  >Hôte</label
                ><input
                  type="text"
                  id="conf-host"
                  class="w-full bg-slate-50 border border-slate-300 rounded p-2"
                />
              </div>
              <div>
                <label class="block text-xs font-bold text-slate-500 mb-1"
                  >Port</label
                ><input
                  type="number"
                  id="conf-port"
                  class="w-full bg-slate-50 border border-slate-300 rounded p-2"
                  value="465"
                />
              </div>
              <div>
                <label class="block text-xs font-bold text-slate-500 mb-1"
                  >Email</label
                ><input
                  type="email"
                  id="conf-email"
                  class="w-full bg-slate-50 border border-slate-300 rounded p-2"
                />
              </div>
              <div>
                <label class="block text-xs font-bold text-slate-500 mb-1"
                  >Mot de passe App</label
                ><input
                  type="password"
                  id="conf-pass"
                  class="w-full bg-slate-50 border border-slate-300 rounded p-2"
                />
              </div>
            </div>
          </div>

          <div
            class="bg-white p-6 rounded-xl shadow-sm border border-slate-200"
          >
            <h3
              class="text-lg font-semibold mb-4 text-indigo-600 border-b pb-2"
            >
              Email
            </h3>
            <div class="mb-4">
              <label class="block text-xs font-bold text-slate-500 mb-1"
                >Objet</label
              ><input
                type="text"
                id="conf-subject"
                class="w-full bg-slate-50 border border-slate-300 rounded p-2"
              />
            </div>
            <div>
              <label class="block text-xs font-bold text-slate-500 mb-1"
                >Corps ({{nom_entreprise}})</label
              ><textarea
                id="conf-body"
                rows="10"
                class="w-full bg-slate-50 border border-slate-300 rounded p-2 font-mono text-xs"
              ></textarea>
            </div>
          </div>

          <div class="flex justify-end pb-10">
            <button
              onclick="saveSettings()"
              class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-3 rounded-lg font-bold shadow-lg transition"
            >
              Sauvegarder
            </button>
          </div>
        </div>
      </div>
    </main>

    <!-- Modal Ajout Manuel -->
    <div
      id="modal-add"
      class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 backdrop-blur-sm"
    >
      <div class="bg-white rounded-xl shadow-2xl p-6 w-96">
        <h3 class="text-lg font-bold mb-4 text-slate-800">
          Nouvelle Entreprise
        </h3>
        <div class="space-y-4">
          <input
            type="text"
            id="new-name"
            class="w-full border p-2 rounded"
            placeholder="Nom (ex: Wellmate)"
          />
          <input
            type="email"
            id="new-email"
            class="w-full border p-2 rounded"
            placeholder="Email Contact"
          />
        </div>
        <div class="mt-6 flex justify-end gap-2">
          <button
            onclick="closeAddModal()"
            class="text-slate-500 hover:bg-slate-100 px-4 py-2 rounded"
          >
            Annuler
          </button>
          <button
            onclick="addCompany()"
            class="bg-indigo-600 text-white px-4 py-2 rounded"
          >
            Ajouter
          </button>
        </div>
      </div>
    </div>

    <!-- Modal Édition -->
    <div
      id="modal-edit"
      class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 backdrop-blur-sm"
    >
      <div class="bg-white rounded-xl shadow-2xl p-6 w-96">
        <h3 class="text-lg font-bold mb-4 text-slate-800">
          Modifier l'Entreprise
        </h3>
        <input type="hidden" id="edit-id" />
        <div class="space-y-4">
          <div>
            <label class="block text-xs font-bold text-slate-500 mb-1"
              >Nom</label
            >
            <input
              type="text"
              id="edit-name"
              class="w-full border p-2 rounded"
            />
          </div>
          <div>
            <label class="block text-xs font-bold text-slate-500 mb-1"
              >Email</label
            >
            <input
              type="email"
              id="edit-email"
              class="w-full border p-2 rounded"
            />
          </div>
        </div>
        <div class="mt-6 flex justify-end gap-2">
          <button
            onclick="closeEditModal()"
            class="text-slate-500 hover:bg-slate-100 px-4 py-2 rounded"
          >
            Annuler
          </button>
          <button
            onclick="updateCompany()"
            class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700"
          >
            Enregistrer
          </button>
        </div>
      </div>
    </div>

    <!-- Modal Preview (NOUVEAU) -->
    <div
      id="modal-preview"
      class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 backdrop-blur-sm"
    >
      <div
        class="bg-white rounded-xl shadow-2xl w-[600px] max-h-[90vh] flex flex-col"
      >
        <div
          class="p-6 border-b border-slate-100 flex justify-between items-center"
        >
          <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
            <i class="fa-solid fa-eye text-indigo-500"></i> Prévisualisation
          </h3>
          <button
            onclick="closePreviewModal()"
            class="text-slate-400 hover:text-slate-600"
          >
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>

        <div class="p-6 overflow-y-auto space-y-4 flex-1">
          <!-- Recap Destinataire -->
          <div
            class="bg-slate-50 p-3 rounded-lg border border-slate-200 text-sm"
          >
            <p>
              <span class="font-bold text-slate-500">À :</span>
              <span id="prev-email" class="text-slate-800"></span>
            </p>
            <p>
              <span class="font-bold text-slate-500">Objet :</span>
              <span id="prev-subject" class="text-slate-800"></span>
            </p>
          </div>

          <!-- Recap Fichiers -->
          <div>
            <p class="text-xs font-bold text-slate-500 mb-2 uppercase">
              Pièces jointes qui seront envoyées :
            </p>
            <div class="flex gap-2">
              <div
                id="prev-file-cv"
                class="bg-indigo-50 text-indigo-700 px-3 py-2 rounded text-xs font-mono border border-indigo-100 flex items-center gap-2"
              >
                <i class="fa-solid fa-file-pdf"></i> <span>...</span>
              </div>
              <div
                id="prev-file-lm"
                class="bg-indigo-50 text-indigo-700 px-3 py-2 rounded text-xs font-mono border border-indigo-100 flex items-center gap-2"
              >
                <i class="fa-solid fa-file-pdf"></i> <span>...</span>
              </div>
            </div>
          </div>

          <!-- Corps du mail -->
          <div>
            <p class="text-xs font-bold text-slate-500 mb-2 uppercase">
              Contenu du mail :
            </p>
            <div
              id="prev-body"
              class="bg-white border border-slate-200 p-4 rounded-lg text-sm text-slate-700 font-mono whitespace-pre-wrap leading-relaxed shadow-inner h-64 overflow-y-auto"
            >
              <!-- Content -->
            </div>
          </div>
        </div>

        <div
          class="p-6 border-t border-slate-100 flex justify-end gap-3 bg-slate-50 rounded-b-xl"
        >
          <button
            onclick="closePreviewModal()"
            class="text-slate-500 hover:bg-white border border-transparent hover:border-slate-300 px-4 py-2 rounded transition"
          >
            Annuler
          </button>
          <button
            id="btn-confirm-send"
            onclick="confirmSend()"
            class="bg-indigo-600 text-white px-6 py-2 rounded font-medium hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition flex items-center gap-2"
          >
            <i class="fa-solid fa-paper-plane"></i> Confirmer & Envoyer
          </button>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div
      id="toast"
      class="fixed bottom-4 right-4 bg-slate-800 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center gap-3"
    >
      <i id="toast-icon" class="fa-solid fa-info-circle"></i>
      <span id="toast-msg">Notification</span>
    </div>

    <!-- Lien vers ton JS externe -->
    <script src="main.js"></script>
  </body>
</html>
